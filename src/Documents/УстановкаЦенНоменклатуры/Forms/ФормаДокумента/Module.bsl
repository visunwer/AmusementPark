
#Область ОбработчикиКомандФормы

&НаКлиенте
Асинх Процедура Загрузить(Команда)
	
	ТекстВопроса = НСтр("ru = 'В таблице уже введены цены. При загрузке из файл таблица будет очищена. Продолжить?'");
	
	Ответ = Ждать ВопросАсинх(ТекстВопроса, РежимДиалогаВопрос.ДаНет);
	
	Если Ответ <> КодВозвратаДиалога.Да Тогда
		Возврат;
	КонецЕсли;
	
	ПараметрыДиалога = Новый ПараметрыДиалогаПомещенияФайлов();
	ПараметрыДиалога.Фильтр = НСтр("ru = 'Файл EXCEL|*.xlsx'");
		
	РезультатПомещения =  Ждать ПоместитьФайлНаСерверАсинх( , , , ПараметрыДиалога);
	
	Если РезультатПомещения = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если РезультатПомещения.ПомещениеФайлаОтменено Тогда
		Возврат;
	КонецЕсли;
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("АдресФайла", РезультатПомещения.Адрес);
	
	Оповещение = Новый ОписаниеОповещения("ЗагрузитьЗавершение", ЭтотОбъект);
	
	ОткрытьФорму("Документ.УстановкаЦенНоменклатуры.Форма.ФормаЗагрузкиИзФайла", ПараметрыФормы,,,,, Оповещение);
	
КонецПроцедуры
#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Процедура ЗагрузитьЗавершение(Результат, ДополнительныеПараметры) Экспорт
	
	Если Результат = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	ЗагрузитьЦеныИзВременногоХранилища(Результат);
		
КонецПроцедуры

//&НаСервере
//Процедура ОбработатьФайлЦен(Адрес)
//	
//	ДвоичныеДанные = ПолучитьИзВременногоХранилища(Адрес);
//	ИмяФайла = ПолучитьИмяВременногоФайла("xlsx");
//	
//	ДвоичныеДанные.Записать(ИмяФайла);
//	
//	ТабличныйДокумент = Новый ТабличныйДокумент;
//	ТабличныйДокумент.Прочитать(ИмяФайла);
//	
//	Объект.ЦеныНоменклатуры.Очистить();
//	
//	Для НомерСтроки = 2 По ТабличныйДокумент.ВысотаТаблицы Цикл
//		
//		Наименование = ТабличныйДокумент.Область(НомерСтроки, 1).Текст;
//		Цена = ТабличныйДокумент.Область(НомерСтроки, 2).Текст;
//		
//		Строка = Объект.ЦеныНоменклатуры.Добавить();
//		Строка.Наименование = Наименование;
//		Строка.Цена = Число(Цена);
//		
//	КонецЦикла;
//	
//	УдалитьФайлы(ИмяФайла);
//	
//КонецПроцедуры

&НаСервере
Процедура ЗагрузитьЦеныИзВременногоХранилища(Адрес)
	Объект.ЦеныНоменклатуры.Загрузить(ПолучитьИзВременногоХранилища(Адрес));
КонецПроцедуры

#КонецОбласти